<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
    <title>Wolfwalkers' Journey</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">
    <link rel="preload" as="image" href="assets/forest_bg.png" fetchpriority="high">
    <link rel="preload" as="image" href="assets/wood_texture.png">
    <link rel="preload" as="image" href="assets/rune_stone.png">
    <link rel="preload" as="image" href="assets/wolf_spirit_blue.png">
    <link rel="stylesheet" href="style.css" />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#3e2723" />
    <link rel="apple-touch-icon" href="icons/icon-192.svg" />
    <script src="app.js" defer></script>
  </head>
  <body>
    <!-- Decorative sparkles (spirits) -->
    <!-- Decorative Spirits -->
    <div class="spirit wolf-spirit spirit-1"></div>
    <div class="spirit wolf-spirit spirit-2"></div>
    <!-- <div class="spirit wolf-spirit spirit-3"></div> -->

    <div class="page-container">
      <!-- Top Wood Header -->
      <header class="wood-header">
        <div class="header-content">
          <button class="rune-btn" onclick="window.location.href='progress.html'" style="width: 50px; height: 50px; position: absolute; right: 20px; top: 15px;" aria-label="Achievements">
            <span style="font-size: 1.5rem;">üèÜ</span>
          </button>
          
          <!-- Audio Controls -->
          <div style="position: absolute; left: 20px; top: 15px; display: flex; gap: 10px; z-index: 100;">
            <button class="rune-btn" id="musicToggleBtn" style="width: 50px; height: 50px; padding: 0;" aria-label="Toggle Music">
              <span style="font-size: 1.5rem;">üéµ</span>
            </button>
            <button class="rune-btn hidden" id="skipTrackBtn" style="width: 50px; height: 50px; padding: 0;" aria-label="Skip Track">
              <span style="font-size: 1.5rem;">‚è≠Ô∏è</span>
            </button>
          </div>

          <h1 class="game-title">Wolfwalkers' Journey</h1>
          <div class="header-progress">
            <div class="progress-label" id="progressLabel">Checkpoint 1 of 9</div>
            <!-- Checkpoint visual path (top version if needed, or keeping it hidden if using bottom path) -->
            <div class="checkpoint-row hidden" id="checkpointRow"></div> 
             <div class="progress-bar" aria-hidden="true">
                <div class="progress-fill" id="progressFill"></div>
            </div>
          </div>
        </div>
      </header>

      <!-- Main Game Area -->
      <main class="game-grid">
        
        <!-- Left Controls Group -->
        <div class="controls-left">
           <!-- Back Button (Wolf Rune Blue) -->
           <div class="control-item">
            <button class="rune-btn rune-blue" id="backButtonNav" aria-label="Back">
                <div class="rune-symbol">‚Äπ</div>
            </button>
            <div class="rune-label">Back</div>
           </div>

           <!-- Pause Button (Paw Rune Red) -->
           <div class="control-item">
            <button class="rune-btn rune-red" id="pauseButton">
                <div class="rune-symbol">‚è∏</div>
            </button>
            <div class="rune-label">Pause</div>
           </div>
        </div>

        <!-- Center Parchment Card -->
        <section class="parchment-card" id="exerciseCard" aria-live="polite">
            <div class="parchment-content">
                <div class="card-header-ornament"></div>
                
                <h2 class="exercise-title" id="exerciseName">Wall Calf Stretch</h2>

                <!-- Exercise image with L/R indicators flanking it -->
                <div class="exercise-visual-wrapper" id="sideVisuals">
                    <div class="side-rune" id="runeLeft">L</div>
                    <div class="exercise-visual">
                      <img id="exerciseImage" src="assets/ex_wall_calf_stretch.png" alt="Exercise illustration" />
                    </div>
                    <div class="side-rune" id="runeRight">R</div>
                </div>
                
                <p class="exercise-desc" id="exerciseInstructions"></p>

                <div class="main-action-area" id="timerArea">
                    <div class="metric-display">
                         <div class="metric-value" id="timerValue">00:30</div>
                         <div class="metric-label-row">
                             <span class="metric-label" id="timerLabel">timer</span>
                             <span class="set-badge-inline" id="setBadge"></span>
                         </div>
                    </div>

                    <button class="wood-btn" id="primaryAction">Start</button>
                </div>
            </div>
            
            <!-- Hidden compatibility elements -->
            <div class="badge hidden" id="typeBadge">Stretch</div>
            <p class="exercise-purpose" id="exercisePurpose" hidden></p>
            <div class="set-status" id="setStatus" hidden>Set 1 of 3</div>
            <div class="side-indicator" id="sideIndicator" hidden>Right</div>
        </section>

        <!-- Right Controls Group -->
        <div class="controls-right">
             <!-- Skip Button (Wolf Jump Green) -->
            <div class="control-item">
                <button class="rune-btn rune-green" id="skipButtonNav" aria-label="Skip">
                    <div class="rune-symbol">‚Ä∫</div>
                </button>
                <div class="rune-label">Skip</div>
               </div>
        </div>

      </main>
      
      <!-- Bottom Path -->
      <footer class="bottom-path-area">
         <ol class="stone-path" id="checkpointPath"></ol>
      </footer>

      <!-- Hidden controls kept for JS compatibility if needed, but we re-mapped IDs above -->
      <div style="display:none;">
        <button id="resumeButton">Resume</button>
         <button id="restartButton">Restart</button>
         <button id="backButton">Back</button>
         <button id="skipButton">Skip</button>
      </div>

    </div>

    <!-- Workout length selection overlay -->
    <div class="overlay hidden" id="workoutLengthOverlay" aria-hidden="true">
      <div class="parchment-modal">
        <h2>Choose Your Journey</h2>
        <p>How long would you like to train today?</p>
        <div class="workout-length-buttons">
          <button class="wood-btn workout-length-btn" id="shortWorkoutBtn">
            <span class="workout-icon">üê∫</span>
            <span class="workout-label">Short Journey</span>
            <span class="workout-desc">Quick training</span>
          </button>
          <button class="wood-btn workout-length-btn" id="longWorkoutBtn">
            <span class="workout-icon">üê∫üê∫</span>
            <span class="workout-label">Long Journey</span>
            <span class="workout-desc">Full training</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Resume session overlay -->
    <div class="overlay hidden" id="resumeOverlay" aria-hidden="true">
      <div class="parchment-modal">
        <h2>Welcome Back, Little Wolf!</h2>
        <p>You have a journey in progress. Would you like to continue?</p>
        <div class="resume-buttons">
          <button class="wood-btn" id="resumeSessionBtn">Resume Journey</button>
          <button class="wood-btn secondary" id="startFreshBtn">Start Fresh</button>
        </div>
      </div>
    </div>

    <!-- Rest overlay -->
    <div class="overlay hidden" id="restOverlay" aria-hidden="true">
      <div class="parchment-modal">
        <h2>Rest, Little Wolf</h2>
        <p id="restNext">Up next: Set 2</p>
        <button class="wood-btn" id="readyButton">Ready</button>
      </div>
    </div>

    <!-- End screen overlay -->
    <div class="overlay hidden" id="endOverlay" aria-hidden="true">
      <div class="parchment-modal end-screen">
        <div class="celebration-header">
          <span class="wolf-icon-large">üê∫</span>
          <h2>Journey Complete!</h2>
        </div>

        <div class="completion-stats">
          <div class="stat-item">
            <div class="stat-value" id="totalTimeValue">00:00</div>
            <div class="stat-label">Total Time</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="exercisesCompleted">9</div>
            <div class="stat-label">Exercises</div>
          </div>
        </div>

        <p class="farewell-message">Great work, little wolf! The forest spirits are proud of you.</p>

        <!-- Reward container placeholder for VS8 -->
        <div class="reward-container" id="rewardContainer"></div>

        <button class="wood-btn secondary" id="closeEndScreen">Done</button>
        <button class="wood-btn" id="restartFromEnd">Start New Journey</button>
      </div>
    </div>

    <!-- Online/Offline Indicator -->
    <div class="connection-indicator" id="connectionIndicator" aria-live="polite">
      <span class="indicator-dot"></span>
      <span class="indicator-text">Online</span>
    </div>

    <!-- Update Available Banner -->
    <div class="update-banner hidden" id="updateBanner" aria-live="polite">
      <span class="update-message">üê∫ Update available!</span>
      <button class="update-btn" id="updateBtn">Reload when ready</button>
      <button class="dismiss-btn" id="dismissUpdate" aria-label="Dismiss">√ó</button>
    </div>
  </body>
</html>
